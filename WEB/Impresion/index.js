const db = {
  "bautizo.jpg": {
    width: "136mm",
    height: "213mm",
    top: "0mm",
    left: "42mm",
    flip: false,
    inputs: [
      {
        top: "59mm",
        left: "65mm",
        width: "100mm",
        placeholder: "Nombre del bebé...",
        fontWeight: 700,
      },
      { top: "66.5mm", left: "62mm", width: "7mm", placeholder: "O/A" },
      { top: "66.5mm", left: "78mm", width: "87mm" },
      { top: "74mm", left: "65mm", width: "100mm" },
      {
        top: "82mm",
        left: "85mm",
        width: "80mm",
        placeholder: "Ciudad...",
      },
      {
        top: "89.5mm",
        left: "67mm",
        width: "12mm",
        textAlign: "center",
      },
      { top: "89.5mm", left: "103.5mm", width: "42mm" },
      {
        top: "89.5mm",
        left: "152mm",
        width: "11mm",
        textAlign: "center",
      },
      {
        top: "105.25mm",
        left: "67mm",
        width: "13mm",
        textAlign: "center",
      },
      { top: "105.25mm", left: "105mm", width: "36mm" },
      {
        top: "105.25mm",
        left: "149mm",
        width: "14mm",
        textAlign: "center",
      },
      { top: "125.5mm", left: "86mm", width: "80mm" },
      { top: "133mm", left: "112mm", width: "54mm" },
      { top: "141mm", left: "54mm", width: "23mm" },
      { top: "141mm", left: "84mm", width: "82mm" },
      {
        top: "148.5mm",
        left: "121mm",
        width: "42mm",
        textAlign: "center",
      },
      {
        top: "156.25mm",
        left: "75mm",
        width: "27mm",
        textAlign: "center",
      },
      {
        top: "156.25mm",
        left: "125mm",
        width: "38mm",
        textAlign: "center",
      },
      {
        top: "163mm",
        left: "50mm",
        width: "117mm",
        placeholder: "Notas marginales...",
        textAlign: "center",
        fontWeight: 700,
      },
      {
        top: "172mm",
        left: "84.5mm",
        width: "9mm",
        textAlign: "center",
      },
      { top: "172mm", left: "117mm", width: "24mm" },
      {
        top: "172mm",
        left: "147.5mm",
        width: "15mm",
        textAlign: "center",
      },
      {
        top: "198.75mm",
        left: "66mm",
        width: "84mm",
        placeholder: "RECTOR PBRO. Luis Armando González Torres",
        value: "RECTOR PBRO. Luis Armando González Torres",
        textAlign: "center",
      },
    ],
  },

  "comunion.jpg": {
    width: "214mm",
    height: "138mm",
    left: "1.5mm",
    top: "38mm",
    flip: true,
    inputs: [
      { top: "74mm", left: "56mm", width: "115mm", fontWeight: 700 },
      { top: "88mm", left: "51mm", width: "22mm", textAlign: "center" },
      { top: "88mm", left: "82mm", width: "63mm" },
      { top: "88mm", left: "150mm", width: "21mm", textAlign: "center" },
      { top: "95mm", left: "82mm", width: "116mm" },
      { top: "102mm", left: "46mm", width: "152mm" },
      { top: "109mm", left: "46mm", width: "152mm" },
      { top: "116mm", left: "46mm", width: "152mm" },
      { top: "123mm", left: "55mm", width: "143mm" },
      { top: "130mm", left: "46mm", width: "152mm" },
      { top: "137mm", left: "28mm", width: "170mm" },
      { top: "144mm", left: "36mm", width: "27mm", textAlign: "center" },
      { top: "151mm", left: "36mm", width: "27mm", textAlign: "center" },
      { top: "158mm", left: "36mm", width: "27mm", textAlign: "center" },
      {
        top: "154.5mm",
        left: "122mm",
        width: "80mm",
        placeholder: "RECTOR PBRO. LUIS ARMANDO GONZÁLEZ TORRES",
        value: "RECTOR PBRO. LUIS ARMANDO GONZÁLEZ TORRES",
        textAlign: "center",
      },
    ],
  },

  "matrimonio.jpg": {
    width: "233mm",
    height: "172mm",
    left: "1mm",
    top: "19mm",
    flip: true,
    inputs: [
      {
        top: "68mm",
        left: "35mm",
        width: "165mm",
        placeholder: "Nombre de los novios...",
        textAlign: "center",
        fontWeight: 700,
        fontSize: "16px",
      },
      { top: "98mm", left: "35mm", width: "10mm", textAlign: "center" },
      { top: "98mm", left: "55mm", width: "40mm" },
      { top: "98mm", left: "115mm", width: "6mm", textAlign: "center" },
      { top: "98mm", left: "162mm", width: "53mm" },
      { top: "118mm", left: "30mm", width: "85mm" },
      { top: "118mm", left: "124mm", width: "85mm" },
      { top: "130mm", left: "30mm", width: "85mm" },
      { top: "130mm", left: "124mm", width: "85mm" },
      { top: "136.5mm", left: "54mm", width: "46mm", textAlign: "center" },
      { top: "141.5mm", left: "54mm", width: "46mm", textAlign: "center" },
      { top: "146.5mm", left: "54mm", width: "46mm", textAlign: "center" },
      { top: "151.5mm", left: "78mm", width: "22mm" },
      { top: "156.5mm", left: "30mm", width: "70mm" },
      {
        top: "156mm",
        left: "124mm",
        width: "85mm",
        placeholder: "PBRO. LUIS ARMANDO GONZÁLEZ TORRES",
        value: "PBRO. LUIS ARMANDO GONZÁLEZ TORRES",
        textAlign: "center",
      },
    ],
  },

  "confirmacion.jpg": {
    width: "212.96mm",
    height: "134.79mm",
    left: "1.5mm",
    top: "41mm",
    flip: true,
    inputs: [
      { top: "91mm", left: "105mm", width: "10mm", textAlign: "center" },
      { top: "91mm", left: "123mm", width: "42mm" },
      { top: "91mm", left: "173mm", width: "22mm", textAlign: "center" },
      { top: "98mm", left: "40mm", width: "155mm", fontWeight: 700 },
      { top: "105mm", left: "25mm", width: "6mm", textAlign: "center" },
      { top: "105mm", left: "35mm", width: "160mm" },
      { top: "112mm", left: "30mm", width: "165mm" },
      { top: "119mm", left: "63mm", width: "132mm" },
      { top: "128mm", left: "80mm", width: "115mm" },
      { top: "141.5mm", left: "105mm", width: "10mm", textAlign: "center" },
      { top: "141.5mm", left: "123mm", width: "42mm" },
      { top: "141.5mm", left: "173mm", width: "22mm", textAlign: "center" },
      { top: "135mm", left: "35mm", width: "160mm" },
      { top: "142mm", left: "40mm", width: "25mm", textAlign: "center" },
      { top: "149mm", left: "40mm", width: "25mm", textAlign: "center" },
      { top: "156mm", left: "40mm", width: "25mm", textAlign: "center" },
      {
        top: "156mm",
        left: "116mm",
        width: "84mm",
        placeholder: "RECTOR PBRO. LUIS ARMANDO GONZÁLEZ TORRES",
        value: "RECTOR PBRO. LUIS ARMANDO GONZÁLEZ TORRES",
        textAlign: "center",
      },
    ],
  },
};

document.addEventListener("DOMContentLoaded", async () => {
  // ################################################################ VARS
  // const controls = document.getElementById("controls");
  const image = document.getElementById("image");

  const select = document.getElementById("select");
  const print = document.getElementById("print");
  const toggle = document.getElementById("toggle");
  const clear = document.getElementById("clear");

  const form = document.getElementById("form");
  const stylesheet = document.getElementById("stylesheet");

  class DOC {
    width = 10;
    height = 10;
    top = 0;
    left = 0;
    flip = false;
    inputs = [input()];
  }

  function input(data = {}) {
    const i = document.createElement("input");
    for (const prop in data) {
      if (i.style[prop] === undefined) i[prop] = data[prop];
      else i.style[prop] = data[prop];
    }
    return i;
  }

  // let docs = { name: new DOC() };
  // docs = await (await fetch("./db.json")).json();
  const docs = db;

  // ################################################################ SETUP
  for (const doc in docs) {
    const op = document.createElement("option");
    op.value = doc;
    op.text = doc.substring(0, doc.length - 4).toUpperCase();
    select.appendChild(op);
  }

  toggle.onchange = () => {
    if (toggle.checked) image.classList.remove("will-hide");
    else image.classList.add("will-hide");
  };

  // ################################################################ SELECT CHANGE
  select.onchange = () => {
    const doc = docs[select.value];

    image.src = `./docs/${select.value}`;
    image.style.backgroundImage = `url(./docs/${select.value})`;
    image.style.width = doc.width;
    image.style.height = doc.height;
    image.style.left = doc.left;
    image.style.top = doc.top;

    form.replaceChildren();
    for (const data of doc.inputs) {
      const io = input(data);
      io.onchange = () => (data.value = io.value);

      form.appendChild(io);
    }

    if (doc.flip) document.body.classList.add("landscape");
    else document.body.classList.remove("landscape");
  };

  // select.selectedIndex = 3;
  select.onchange();

  // ################################################################ PRINT CLICK
  print.onclick = () => {
    const doc = docs[select.value];
    if (doc.flip) {
      document.body.classList.add("landscape");
      stylesheet.innerHTML = `@media print {body.landscape {width: ${doc.height}; height: ${doc.width};}}`;
    } else {
      document.body.classList.remove("landscape");
      stylesheet.innerHTML = `@media print {body.landscape {width: ${doc.width}; height: ${doc.height};}}`;
    }

    window.print();
  };

  function plain(str = "") {
    return str
      .toString()
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "");
  }

  // ################################################################ CLEAR CLICK
  clear.onclick = () => {
    for (const input of form.children) {
      if (plain(input.value) !== plain(input.placeholder)) {
        input.value = "";
        input.onchange();
      }
    }
  };

  window.onmousedown = (e) => {
    console.log(e.pageX / 3.7795280352161, e.pageY / 3.7795280352161);
  };
});

function saveStyles(el = document.getElementById("form")) {
  for (const i of el.children) {
    let ss = "{ ";
    ss += i.style.top && `top: "${i.style.top}", `;
    ss += i.style.left && `left: "${i.style.left}", `;
    ss += i.style.width && `width: "${i.style.width}", `;
    ss += i.placeholder && `placeholder: "${i.placeholder}", `;
    ss += i.value && `value: "${i.value}", `;
    ss += i.style.textAlign && `textAlign: "${i.style.textAlign}", `;
    ss += i.style.fontWeight && `fontWeight: ${i.style.fontWeight}, `;
    ss += i.style.fontSize && `fontSize: "${i.style.fontSize}", `;
    ss += " },";
    console.log(ss);
  }
}
